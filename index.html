<!doctype html>
<html>
  <head>
  <meta charset=utf8 />
  <style>
  html,body { width:100%;height:100%;margin:0 }
  #src {
      width:100%;
      height:100%;
      font-family:monospace;
      font-size:24px;
      line-height:48px;
  }
  </style>
  </head>
  <body>
    <div id='mp_js_stdout'></div>
    <textarea id=src class=language-python></textarea>
    <script src="micropython/micropython.js"></script>
    <script>
      expected = "[0, 1, 2, 3, 4]"
    
      mp_js_stdout.addEventListener('print', function(e) {
        e.target.textContent += e.data
      }, false)

      function execute() {
        let src = document.querySelector('textarea')
        let out = document.querySelector('#mp_js_stdout')
      
        out.textContent = ''
        mp_js_init(64 * 1024)
        mp_js_do_str(src.value)

        if (expected) {
          if (expected == out.textContent.trim()) {
            out.textContent = '✔️' + ' ' + out.textContent
          } else {
            out.textContent = '❌️' + ' ' + out.textContent
          }
        }
      }

      // Wait for Mircopython to be ready
      // There's probably a better way to do this
      function onload() {
        if (typeof mp_js_init == 'function') {
          document.querySelector('#src').addEventListener('input', execute)
          execute()
        } else {
          setTimeout(onload, 10)
        }
      }
      onload()
    </script>
  </body>
</html>